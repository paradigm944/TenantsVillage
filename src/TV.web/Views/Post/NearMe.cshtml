@model TV.web.ViewModels.AddressViewModel

<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false">
    </script>

    <script>
        var FormZipCode = '@Model.ZipCode';
        var zipSearch = '@Model.IsZipSearch';
        //google.maps.event.trigger(map, 'resize');

    function coden(MapProperties, Map, ZipCode) {
        $.getJSON('@Url.Content("~/Post/GetAddresses/?zipCode=")' + FormZipCode, function (data) {
            //var geoCodeResults = new Array();
            geocoder = new google.maps.Geocoder();
            $.each(data, function (i, item) {
                geocoder.geocode({ 'address': data[i] }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        //geoCodeResults[i] = results[0].geometry.location;
                        //console.log(data[i]);

                        var marker = new google.maps.Marker({
                            position: UserCoords = new google.maps.LatLng(results[0].geometry.location.d, results[0].geometry.location.e),
                            map: Map,
                            title: data[i]
                        });

                        marker.setIcon('@Url.Content("~/Content/blue-dot.png")')

                        marker.setMap(Map);

                        var infowindow = new google.maps.InfoWindow({
                            content: "<div class='infoDiv'><h4>" + data[i] + "</h2>" + "<div><h4></h4></div></div>"
                        });

                        // onClick listener
                        google.maps.event.addListener(marker, 'click', function () {
                            infowindow.open(Map, marker);
                        });

                    }
                })
            })
        })
    }

    function initialize() {
        if (zipSearch) {        
            geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 'address': FormZipCode }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) { 
                    UserCoords2 = new google.maps.LatLng(results[0].geometry.location.d, results[0].geometry.location.e);
                    console.log(UserCoords2);

                    var mapProp = {
                        center: UserCoords2,
                        zoom: 12,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };

                    var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);


                    var marker = new google.maps.Marker({
                        position: UserCoords2,
                        title: "You"
                    });

                    marker.setMap(map);

                    var infowindow = new google.maps.InfoWindow({
                        content: "<div class='infoDiv'><h2>" + marker.title + "</h2>" + "<div><h4></h4></div></div>"
                    });

                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.open(map, marker);
                    });

                    coden(mapProp, map, FormZipCode);
                }
             })
        }
        else {
            if (navigator.geolocation) {
                browserSupportFlag = true;
                navigator.geolocation.getCurrentPosition(function (position) {

                    UserCoords = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

                    var mapProp = {
                        center: UserCoords,
                        zoom: 12,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };

                    var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

                    var marker = new google.maps.Marker({
                        position: UserCoords,
                        title: "You are approximately here"
                    });

                    marker.setMap(map);

                    var infowindow = new google.maps.InfoWindow({
                        content: "<div class='infoDiv'><h2>" + marker.title + "</h2>" + "<div><h4></h4></div></div>"
                    });

                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.open(map, marker);
                    });

                    geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ 'latLng': UserCoords }, function (results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            var zip = results[0].address_components[7].short_name;
                            coden(mapProp, map, zip);
                        }
                    })     
                 })
               }
             }
          }


        google.maps.event.addDomListener(window, 'load', initialize);


    </script>
</head>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(false)

    
    <body>
        <div class="row">
            <div class="col-lg-4">
                @Html.LabelFor(m => m.ZipCode)<br />
                @Html.TextBoxFor(m => m.ZipCode)
            </div>
            <div class="col-lg-4">
                <br />
                <button class="btn btn-primary" type="submit">Search</button>
            </div>
        </div>
        <br />
        <div class="row">
            <div class="col-lg-12">
                <div id="googleMap" style="width:1000px;height:760px;"></div>
            </div>
        </div>
        </body>
}

</html>













































































































@*
    @section scripts{
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            initialize();
        });
        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng(6.9167, 79.8473),
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map_canvas"),
              mapOptions);
            // create a marker
            var latlng = new google.maps.LatLng(6.9167, 79.8473);
            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                title: 'My Place'
            });
        }

        var data = new Array();
        data[0] = '@Model.PostAddresses[0]';
        data[1] = '@Model.PostAddresses[1]';
        data[2] = '@Model.PostAddresses[2]';
        data[3] = '@Model.PostAddresses[3]';

        if (navigator.geolocation) {
            browserSupportFlag = true;
            navigator.geolocation.getCurrentPosition(function (position) {

                UserCoords = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                var mapOptions = {
                    zoom: 14,
                    center: UserCoords,
                    mapTypeId: google.maps.MapTypeId.G_NORMAL_MAP
                };


                var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
                var marker = new google.maps.Marker({
                    position: UserCoords,
                    map: map,
                    title: 'You are approximately here'
                });


                // Using the JQuery "each" selector to iterate through the JSON list and drop marker pins
                //$.each(data, function (i, item) {
                //    var marker = new google.maps.Marker({
                //        'position': new google.maps.LatLng(item.e, item.d),
                //        'map': map,
                //        'title': item.PlaceName
                //    });
                //});

                //var marker = new google.maps.Marker({
                //    position: results[0].geometry.location,
                //    map: map,
                //    title: 'Latitude: ' + results[0].geometry.location.Ya + ' Longitude :' + results[0].geometry.location.Za
                //});

            })
        }
        var geocoder;


        function coden(addresses) {
            geocoder = new google.maps.Geocoder();
            var geoCodeResults = new Array();
            //var map = new google.maps.Map(document.getElementById("map_canvas"));
            //console.log(addresses.length)
            for(i=0;i<=0;i++) {
                geocoder.geocode({ 'address': addresses[i] }, function (results, status, map) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        geoCodeResults[i] = results[0].geometry.location;
                        console.log(geoCodeResults[i].e);
                        var mapOptions = {
                            zoom: 14,
                            center: UserMap,
                            mapTypeId: google.maps.MapTypeId.G_NORMAL_MAP
                        };
                        var map = google.maps.Map(document.getElementById("map_canvas"), mapOptions);
                        var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(geoCodeResults[i].e, geoCodeResults[i].d),
                            map: UserMap,
                            title: 'You are approximately here'
                        });


                    }
                })
            }

        };



        coden(data);

    </script>
    }

    <h3>Google Maps Demo using MVC 4</h3>
    <br />
    <div id="map_canvas" style="width: 640px; height: 480px;">
    </div>*@